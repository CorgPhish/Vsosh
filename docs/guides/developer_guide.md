# Руководство разработчика CorgPhish

Данное руководство предназначено для разработчиков, желающих внести вклад в проект CorgPhish или разобраться в его внутреннем устройстве.

## Содержание

1. [Настройка среды разработки](#настройка-среды-разработки)
2. [Структура кода](#структура-кода)
3. [Архитектура приложения](#архитектура-приложения)
4. [Модель машинного обучения](#модель-машинного-обучения)
5. [Расширение для браузера](#расширение-для-браузера)
6. [Процесс сборки](#процесс-сборки)
7. [Тестирование](#тестирование)
8. [Внесение изменений](#внесение-изменений)

## Настройка среды разработки

### Требования

- Python 3.8+
- Node.js 14+
- Git
- Браузер Chrome/Firefox для тестирования

### Настройка окружения

1. Клонирование репозитория:
```bash
git clone https://github.com/physcorgi/CorgPhish.git
cd CorgPhish
```

2. Создание виртуального окружения Python:
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate     # Windows
```

3. Установка зависимостей:
```bash
pip install -r requirements.txt
```

4. Установка инструментов для разработки:
```bash
pip install -r requirements-dev.txt  # если файл существует
```

## Структура кода

Основная структура проекта:

```
CorgPhish/
├── src/                  # Исходный код
│   ├── extension/        # Код расширения для браузера
│   │   ├── css/          # CSS стили
│   │   ├── html/         # HTML файлы интерфейса
│   │   ├── icons/        # Иконки расширения
│   │   ├── images/       # Изображения 
│   │   ├── js/           # JavaScript файлы
│   │   │   ├── models/   # JavaScript модели ML
│   │   │   └── utils/    # Вспомогательные утилиты
│   │   └── manifest.json # Манифест расширения
│   ├── common/           # Общие компоненты
│   │   ├── classifier/   # Классификаторы ML
│   │   ├── dataset/      # Данные для обучения
│   │   └── utils/        # Общие утилиты
│   └── frontend/         # Код для веб-интерфейса
├── tests/                # Тесты
├── scripts/              # Вспомогательные скрипты
├── phishing_demo/        # Демонстрационная среда
```

## Архитектура приложения

CorgPhish построен по модульной архитектуре и состоит из следующих основных компонентов:

### Модуль машинного обучения (src/common)

Отвечает за:
- Обучение модели на основе собранных данных
- Извлечение признаков из веб-страниц
- Экспорт модели в формат, доступный для JavaScript

Основные файлы:
- `classifier/model.py` - основная логика классификации
- `export_model.py` - экспорт модели в JavaScript
- `dataset/features.py` - извлечение признаков

### Модуль расширения (src/extension)

Отвечает за:
- Анализ веб-страниц в реальном времени
- Отображение результатов пользователю
- Взаимодействие с браузером через API расширений

Основные скрипты:
- `js/content.js` - анализ DOM-структуры страницы
- `js/background.js` - фоновая логика расширения
- `js/popup.js` - логика всплывающего окна
- `js/models/model.js` - скомпилированная ML-модель

## Модель машинного обучения

### Используемые алгоритмы

Основная модель построена на алгоритме XGBoost с оптимизированными гиперпараметрами:
- `max_depth: 6`
- `learning_rate: 0.1`
- `n_estimators: 100`
- `objective: binary:logistic`

### Признаки для классификации

Модель использует более 50 признаков, включая:

#### URL-признаки:
- Длина URL
- Количество поддоменов
- Наличие IP-адреса вместо домена
- Возраст домена

#### HTML-признаки:
- Количество форм
- Соотношение внешних/внутренних ссылок
- Наличие полей для ввода пароля
- Скрытые элементы

### Обучение модели

Для обучения модели используйте скрипт:
```bash
python src/common/classifier/train.py --data dataset.csv --output model.pkl
```

### Экспорт модели

Для экспорта модели в формат JavaScript:
```bash
python src/common/export_model.py --model model.pkl --output src/extension/js/models/model.js
```

## Расширение для браузера

### Структура расширения

Расширение состоит из следующих компонентов:
- **Background Script**: фоновый процесс, отвечающий за анализ страниц
- **Content Script**: взаимодействует с DOM страницы
- **Popup**: пользовательский интерфейс расширения
- **Options Page**: страница настроек

### Жизненный цикл работы

1. При загрузке страницы активируется content script
2. Скрипт собирает данные о странице и передает их в background script
3. Background script использует ML-модель для анализа данных
4. Результат отображается в popup и/или через уведомления

### Модификация расширения

Для внесения изменений в расширение:
1. Модифицируйте соответствующие файлы в `src/extension`
2. Используйте скрипт сборки для создания нового пакета
3. Загрузите расширение в браузер для тестирования

## Процесс сборки

### Полная сборка

Для полной сборки проекта запустите:
```bash
python build.py
```

Этот скрипт:
- Экспортирует модель ML в JavaScript
- Копирует все необходимые файлы в папку `dist`
- Создает архив с расширением

### Дополнительные опции сборки

```bash
# Пропустить экспорт модели
python build.py --skip-model

# Создать отладочную версию
python build.py --debug

# Указать выходную директорию
python build.py --output custom_output
```

## Тестирование

### Модульные тесты

Для запуска модульных тестов:
```bash
pytest tests/
```

### Тестирование расширения

1. Соберите проект: `python build.py`
2. Загрузите расширение в браузер из папки `dist/browser_extension`
3. Запустите демонстрационную среду: `cd phishing_demo && bash run_demo.sh`
4. Проверьте работу расширения на демо-страницах

## Внесение изменений

### Процесс создания Pull Request

1. Форкните репозиторий
2. Создайте новую ветку: `git checkout -b feature/new-feature`
3. Внесите изменения и следуйте стилю кода
4. Напишите тесты для новой функциональности
5. Убедитесь, что все тесты проходят
6. Создайте Pull Request в основной репозиторий

### Стиль кода

- **Python**: Следуйте PEP 8 и используйте форматер `black`
- **JavaScript**: Следуйте стилю Airbnb JS Guide
- **Именование**: Используйте осмысленные имена переменных и функций

### Документация

При внесении изменений также обновите соответствующую документацию:
- Добавление новой функциональности: обновите руководство пользователя
- Изменение API: обновите руководство разработчика
- Исправление ошибок: добавьте запись в CHANGELOG.md

---

© 2023-2025 CorgPhish Team. Все права защищены. 